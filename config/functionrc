" {{{ StripTrailingWhitespace
function! StripTrailingWhitespace()
    if !&binary && &filetype != 'diff'
        normal mz
        normal Hmy
        %s/\s\+$//e
        normal 'yz<CR>
        normal `z
    endif
endfunction
command! StripTrailingWhitespace call StripTrailingWhitespace()
"}}}

" {{{ StripDoubleEmptyLines
function! StripDoubleEmptyLines()
    if !&binary && &filetype != 'diff'
        normal mz
        normal Hmy
        %s/\(^\s*$\n\)\{2,\}/\r/e
        normal 'yz<CR>
        normal `z
    endif
endfunction
command! StripDoubleEmptyLines call StripDoubleEmptyLines()
"}}}

" {{{ ConvertToUnix
function! DosToUnix()
    execute "update"
    execute "edit ++ff=dos"
    execute "setlocal ff=unix"
    execute "write"
endfunction
command! DosToUnix call DosToUnix()
"}}}

" {{{ GuiTabLabel
function! GuiTabLabel()
    " Append the tab number
    let label=v:lnum . ': '
    let bufnrlist=tabpagebuflist(v:lnum)

    " Append the buffer name
    let name=bufname(bufnrlist[tabpagewinnr(v:lnum) - 1])
    if name == ''
        " give a name to no-name documents
        if &buftype=='quickfix'
            let name='[Quickfix List]'
        else
            let name='[No Name]'
        endif
    else
        " get only the file name
        let name=fnamemodify(name,":t")
    endif

    let label .= name

    " Add '+' if one of the buffers in the tab page is modified
    for bufnr in bufnrlist
        if getbufvar(bufnr, "&modified")
            let label .= ' [+]'
            break
        endif
    endfor

    return label
endfunction
"}}}

" {{{ ConfigureProjectRsync
function! ConfigureProjectRsync(source, dest)
    let l:rsync_options = [
                \ '--archive',
                \ '--chmod="ug=rwX,o=rX"',
                \ '--compress',
                \ '--cvs-exclude',
                \ '--delete',
                \ '--delete-excluded',
                \ '--prune-empty-dirs',
                \ '--quiet',
                \ '--verbose',
                \ '--whole-file',
                \ ]
    let l:rsync_ignore = [
                \ '"*.pyc"',
                \ '".*swp"',
                \ '".git*"',
                \ '"DS_Store"',
                \ '"bin"',
                \ '"build"',
                \ '"cscope.out*"',
                \ '"env"',
                \ '"reports"',
                \ '"tests*"',
                \ '"vagrant"',
                \ ]

    let l:cmd = '!rsync '
    let l:cmd .= join(l:rsync_options, ' ')
    let l:cmd .= ' --exclude='
    let l:cmd .= join(l:rsync_ignore, ' --exclude=')
    let l:cmd .= ' '.a:source.' '.a:dest.' &'

    let g:rsync_command = l:cmd
    autocmd! BufWritePost,FileWritePost * silent execute g:rsync_command
endfunction
"}}}

" vim: filetype=vim textwidth=80 foldmethod=marker
